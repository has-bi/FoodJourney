generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(uuid())
  username    String   @unique @db.VarChar(20)
  displayName String   @map("display_name") @db.VarChar(50)
  color       String   @db.VarChar(7)
  createdAt   DateTime @default(now()) @map("created_at")

  places Place[]

  @@map("users")
}

model Place {
  id        String        @id @default(uuid())
  name      String        @db.VarChar(200)
  mapsLink  String        @map("maps_link")
  category  PlaceCategory

  // Basic info from Gemini
  cuisine   String?       @db.VarChar(100)
  area      String?       @db.VarChar(100) // e.g., "Bintaro", "Senayan"

  // Pricing
  priceRangeText  String?   @map("price_range_text") @db.VarChar(50) // "50-100k IDR"
  priceCategory   String?   @map("price_category") @db.VarChar(20) // budget/moderate/expensive/premium

  // Menu - stored as JSON
  signatureMenus  Json?     @map("signature_menus") // [{name, price}]

  // Quality indicators
  googleRating    Float?    @map("google_rating")
  reviewCount     Int?      @map("review_count")

  // Practical info
  commonComplaint String?   @map("common_complaint")
  waitTime        String?   @map("wait_time") @db.VarChar(50)
  parkingInfo     String?   @map("parking_info") @db.VarChar(100)
  operatingHours  String?   @map("operating_hours") @db.VarChar(100)

  // AI confidence
  aiConfidence    String?   @map("ai_confidence") @db.VarChar(10) // high/medium/low

  // Metadata
  addedBy   User     @relation(fields: [addedById], references: [id])
  addedById String   @map("added_by")
  addedAt   DateTime @default(now()) @map("added_at")
  status    PlaceStatus @default(suggested)

  // Approval
  hasbiApproved Boolean @default(false) @map("hasbi_approved")
  nadyaApproved Boolean @default(false) @map("nadya_approved")

  // Notes when suggesting
  suggestedNotes String? @map("suggested_notes")

  // After visit
  visitedAt DateTime? @map("visited_at")
  photoUrl  String?   @map("photo_url")

  // Hasbi's review
  hasbiRating Int?    @map("hasbi_rating")
  hasbiNotes  String? @map("hasbi_notes")
  hasbiReviewedAt DateTime? @map("hasbi_reviewed_at")

  // Nadya's review
  nadyaRating Int?    @map("nadya_rating")
  nadyaNotes  String? @map("nadya_notes")
  nadyaReviewedAt DateTime? @map("nadya_reviewed_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([status])
  @@index([addedById])
  @@index([category])
  @@index([visitedAt(sort: Desc)])
  @@map("places")
}

model AppConfig {
  id        String   @id @default(uuid())
  key       String   @unique @db.VarChar(50)
  value     String
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("app_config")
}

enum PlaceStatus {
  suggested
  planned
  archived
  skipped
}

enum PlaceCategory {
  cafe
  resto
  sushi
  fine_dining
  street_food
  dessert
}
